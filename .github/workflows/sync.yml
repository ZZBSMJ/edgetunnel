name: Force Sync main from upstream

permissions:
  contents: write

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:

jobs:
  force-sync:
    runs-on: ubuntu-latest
    if: ${{ github.event.repository.fork }}

    steps:
      # 1. 这里改为检出 beta2.0 分支 (作为操作的基础环境)
      - name: Checkout control branch (beta2.0)
        uses: actions/checkout@v4
        with:
          ref: beta2.0  
          fetch-depth: 0

      - name: Add upstream remote
        run: |
          git remote add upstream https://github.com/cmliu/edgetunnel.git
          git fetch upstream

      # 2. 这里改为从 upstream/main 强制创建/重置本地 main 分支
      - name: Force sync main with upstream
        run: |
          git checkout -B main upstream/main

      # 3. 这里改为强制推送到远程 main 分支
      - name: Force push main
        run: |
          git push origin main --force
